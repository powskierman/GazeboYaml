# OpenMeteo Weather REST Sensors
# This file contains all OpenMeteo API REST sensors for the Gazebo Thermostat project

rest:
  - resource: "https://api.open-meteo.com/v1/forecast?latitude=45.2631&longitude=-71.9788&hourly=apparent_temperature,precipitation_probability,temperature,precipitation,relative_humidity_2m,weathercode&current=temperature_2m,relative_humidity_2m,apparent_temperature&temperature_unit=celsius&precipitation_unit=mm&timezone=auto&forecast_days=3"
    scan_interval: 600
    sensor:
      # Current conditions
      - name: "Gazebo Current Temperature"
        unique_id: gazebo_current_temperature_2
        value_template: "{{ value_json['current']['temperature_2m'] }}"
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement

      - name: "Gazebo Current Apparent Temperature"
        unique_id: gazebo_current_apparent_temperature_2
        value_template: "{{ value_json['current']['apparent_temperature'] }}"
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement

      - name: "Gazebo Current Humidity"
        unique_id: gazebo_current_humidity_2
        value_template: "{{ value_json['current']['relative_humidity_2m'] }}"
        unit_of_measurement: "%"
        device_class: humidity
        state_class: measurement

      # Hourly "feels like" temperatures (dynamic indices based on current hour)
      - name: "Gazebo Hour 0 Feels Like"
        unique_id: gazebo_hour_0_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][now().hour] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      - name: "Gazebo Hour 1 Feels Like"
        unique_id: gazebo_hour_1_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][(now().hour + 1) % 24] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      - name: "Gazebo Hour 2 Feels Like"
        unique_id: gazebo_hour_2_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][(now().hour + 2) % 24] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      - name: "Gazebo Hour 3 Feels Like"
        unique_id: gazebo_hour_3_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][(now().hour + 3) % 24] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      - name: "Gazebo Hour 4 Feels Like"
        unique_id: gazebo_hour_4_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][(now().hour + 4) % 24] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      - name: "Gazebo Hour 5 Feels Like"
        unique_id: gazebo_hour_5_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][(now().hour + 5) % 24] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      - name: "Gazebo Hour 6 Feels Like"
        unique_id: gazebo_hour_6_feels_like_2
        value_template: "{{ value_json['hourly']['apparent_temperature'][(now().hour + 6) % 24] }}"
        unit_of_measurement: "°C"
        device_class: temperature

      # Hourly precipitation probabilities (dynamic indices based on current hour)
      - name: "Gazebo Hour 0 Precipitation"
        unique_id: gazebo_hour_0_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][now().hour] }}"
        unit_of_measurement: "%"

      - name: "Gazebo Hour 1 Precipitation"
        unique_id: gazebo_hour_1_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][(now().hour + 1) % 24] }}"
        unit_of_measurement: "%"

      - name: "Gazebo Hour 2 Precipitation"
        unique_id: gazebo_hour_2_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][(now().hour + 2) % 24] }}"
        unit_of_measurement: "%"

      - name: "Gazebo Hour 3 Precipitation"
        unique_id: gazebo_hour_3_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][(now().hour + 3) % 24] }}"
        unit_of_measurement: "%"

      - name: "Gazebo Hour 4 Precipitation"
        unique_id: gazebo_hour_4_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][(now().hour + 4) % 24] }}"
        unit_of_measurement: "%"

      - name: "Gazebo Hour 5 Precipitation"
        unique_id: gazebo_hour_5_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][(now().hour + 5) % 24] }}"
        unit_of_measurement: "%"

      - name: "Gazebo Hour 6 Precipitation"
        unique_id: gazebo_hour_6_precipitation_2
        value_template: "{{ value_json['hourly']['precipitation_probability'][(now().hour + 6) % 24] }}"
        unit_of_measurement: "%"

      # Hourly weather codes for weather icons
      - name: "Gazebo Hour 0 Weather Code"
        unique_id: gazebo_hour_0_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][now().hour] }}"
        unit_of_measurement: ""

      - name: "Gazebo Hour 1 Weather Code"
        unique_id: gazebo_hour_1_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][(now().hour + 1) % 24] }}"
        unit_of_measurement: ""

      - name: "Gazebo Hour 2 Weather Code"
        unique_id: gazebo_hour_2_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][(now().hour + 2) % 24] }}"
        unit_of_measurement: ""

      - name: "Gazebo Hour 3 Weather Code"
        unique_id: gazebo_hour_3_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][(now().hour + 3) % 24] }}"
        unit_of_measurement: ""

      - name: "Gazebo Hour 4 Weather Code"
        unique_id: gazebo_hour_4_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][(now().hour + 4) % 24] }}"
        unit_of_measurement: ""

      - name: "Gazebo Hour 5 Weather Code"
        unique_id: gazebo_hour_5_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][(now().hour + 5) % 24] }}"
        unit_of_measurement: ""

      - name: "Gazebo Hour 6 Weather Code"
        unique_id: gazebo_hour_6_weather_code_2
        value_template: "{{ value_json['hourly']['weathercode'][(now().hour + 6) % 24] }}"
        unit_of_measurement: ""

# Group all the gazebo sensors for easy access
group:
  gazebo_sensors:
    name: "Gazebo Weather Sensors"
    entities:
      - sensor.gazebo_current_temperature_2
      - sensor.gazebo_current_apparent_temperature_2
      - sensor.gazebo_current_humidity_2
      - sensor.gazebo_hour_0_feels_like_2
      - sensor.gazebo_hour_1_feels_like_2
      - sensor.gazebo_hour_2_feels_like_2
      - sensor.gazebo_hour_3_feels_like_2
      - sensor.gazebo_hour_4_feels_like_2
      - sensor.gazebo_hour_5_feels_like_2
      - sensor.gazebo_hour_6_feels_like_2
      - sensor.gazebo_hour_0_precipitation_2
      - sensor.gazebo_hour_1_precipitation_2
      - sensor.gazebo_hour_2_precipitation_2
      - sensor.gazebo_hour_3_precipitation_2
      - sensor.gazebo_hour_4_precipitation_2
      - sensor.gazebo_hour_5_precipitation_2
      - sensor.gazebo_hour_6_precipitation_2
      - sensor.gazebo_hour_0_weather_code_2
      - sensor.gazebo_hour_1_weather_code_2
      - sensor.gazebo_hour_2_weather_code_2
      - sensor.gazebo_hour_3_weather_code_2
      - sensor.gazebo_hour_4_weather_code_2
      - sensor.gazebo_hour_5_weather_code_2
      - sensor.gazebo_hour_6_weather_code_2

# Recorder exclusions for OpenMeteo sensors
# Exclude hourly forecast sensors from database to save space
recorder:
  exclude:
    entities:
      - sensor.gazebo_hour_1_feels_like_2
      - sensor.gazebo_hour_2_feels_like_2
      - sensor.gazebo_hour_3_feels_like_2
      - sensor.gazebo_hour_4_feels_like_2
      - sensor.gazebo_hour_5_feels_like_2
      - sensor.gazebo_hour_6_feels_like_2
      - sensor.gazebo_hour_1_precipitation_2
      - sensor.gazebo_hour_2_precipitation_2
      - sensor.gazebo_hour_3_precipitation_2
      - sensor.gazebo_hour_4_precipitation_2
      - sensor.gazebo_hour_5_precipitation_2
      - sensor.gazebo_hour_6_precipitation_2
      - sensor.gazebo_hour_0_weather_code_2
      - sensor.gazebo_hour_1_weather_code_2
      - sensor.gazebo_hour_2_weather_code_2
      - sensor.gazebo_hour_3_weather_code_2
      - sensor.gazebo_hour_4_weather_code_2
      - sensor.gazebo_hour_5_weather_code_2
      - sensor.gazebo_hour_6_weather_code_2
